<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Hydrological Analysis | TerraHidro User Manual</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Hydrological Analysis | TerraHidro User Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Hydrological Analysis | TerraHidro User Manual" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Division of Earth Observation and Geoinformatics - DIOTG" />


<meta name="date" content="2025-10-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="parts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TerraHidro User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#project-highlights"><i class="fa fa-check"></i>Project Highlights</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#qgis-plugin-installation-and-setup"><i class="fa fa-check"></i>QGIS Plugin Installation and Setup</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#installing-the-terrahidro-plugin-in-qgis"><i class="fa fa-check"></i>Installing the TerraHidro Plugin in QGIS</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#configuring-the-terrahidro-environment-variable-windows"><i class="fa fa-check"></i>Configuring the <code>TERRAHIDRO</code> Environment Variable (Windows)</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#final-step"><i class="fa fa-check"></i>Final Step</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#command-line-interface"><i class="fa fa-check"></i>Command-Line Interface</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#example-removing-pits-with-the-pfs-operation"><i class="fa fa-check"></i>Example: Removing Pits with the <code>pfs</code> Operation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html"><i class="fa fa-check"></i><b>3</b> Hydrological Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#DEM-Pre-processing-and-Correction"><i class="fa fa-check"></i><b>3.1</b> DEM Pre-processing and Correction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#simplepits"><i class="fa fa-check"></i><b>3.1.1</b> simplepits</a></li>
<li class="chapter" data-level="3.1.2" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#agreedem"><i class="fa fa-check"></i><b>3.1.2</b> agreedem</a></li>
<li class="chapter" data-level="3.1.3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#carve"><i class="fa fa-check"></i><b>3.1.3</b> carve</a></li>
<li class="chapter" data-level="3.1.4" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#carvev"><i class="fa fa-check"></i><b>3.1.4</b> carvev</a></li>
<li class="chapter" data-level="3.1.5" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#fill"><i class="fa fa-check"></i><b>3.1.5</b> fill</a></li>
<li class="chapter" data-level="3.1.6" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#flatareas"><i class="fa fa-check"></i><b>3.1.6</b> flatareas</a></li>
<li class="chapter" data-level="3.1.7" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#pfs"><i class="fa fa-check"></i><b>3.1.7</b> pfs</a></li>
<li class="chapter" data-level="3.1.8" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#pfsd"><i class="fa fa-check"></i><b>3.1.8</b> pfsd</a></li>
<li class="chapter" data-level="3.1.9" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#removepits"><i class="fa fa-check"></i><b>3.1.9</b> removepits</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#Flow-Analysis-Drainage-Network-Extraction-and-Characterization"><i class="fa fa-check"></i><b>3.2</b> Flow Analysis, Drainage Network Extraction and Characterization</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#d8"><i class="fa fa-check"></i><b>3.2.1</b> d8</a></li>
<li class="chapter" data-level="3.2.2" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#d8ca"><i class="fa fa-check"></i><b>3.2.2</b> d8ca</a></li>
<li class="chapter" data-level="3.2.3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#d8drainage"><i class="fa fa-check"></i><b>3.2.3</b> d8drainage</a></li>
<li class="chapter" data-level="3.2.4" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#d8drainagev"><i class="fa fa-check"></i><b>3.2.4</b> d8drainagev</a></li>
<li class="chapter" data-level="3.2.5" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#segments"><i class="fa fa-check"></i><b>3.2.5</b> segments</a></li>
<li class="chapter" data-level="3.2.6" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#minibasins"><i class="fa fa-check"></i><b>3.2.6</b> minibasins</a></li>
<li class="chapter" data-level="3.2.7" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#outletbasin"><i class="fa fa-check"></i><b>3.2.7</b> outletbasin</a></li>
<li class="chapter" data-level="3.2.8" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#mainriver"><i class="fa fa-check"></i><b>3.2.8</b> mainriver</a></li>
<li class="chapter" data-level="3.2.9" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#shreve"><i class="fa fa-check"></i><b>3.2.9</b> shreve</a></li>
<li class="chapter" data-level="3.2.10" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#strahler"><i class="fa fa-check"></i><b>3.2.10</b> strahler</a></li>
<li class="chapter" data-level="3.2.11" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#ottorivers"><i class="fa fa-check"></i><b>3.2.11</b> ottorivers</a></li>
<li class="chapter" data-level="3.2.12" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#mouths"><i class="fa fa-check"></i><b>3.2.12</b> mouths</a></li>
<li class="chapter" data-level="3.2.13" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#orderedmouths"><i class="fa fa-check"></i><b>3.2.13</b> orderedmouths</a></li>
<li class="chapter" data-level="3.2.14" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#ottorivers"><i class="fa fa-check"></i><b>3.2.14</b> ottorivers</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#Basin-and-Sub-basin-Delineation"><i class="fa fa-check"></i><b>3.3</b> Basin and Sub-basin Delineation</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#minibasins"><i class="fa fa-check"></i><b>3.3.1</b> minibasins</a></li>
<li class="chapter" data-level="3.3.2" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#outletbasin"><i class="fa fa-check"></i><b>3.3.2</b> outletbasin</a></li>
<li class="chapter" data-level="3.3.3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#ottobasins"><i class="fa fa-check"></i><b>3.3.3</b> ottobasins</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#Geomorphometric-analysis"><i class="fa fa-check"></i><b>3.4</b> Geomorphometric analysis</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#tpi"><i class="fa fa-check"></i><b>3.4.1</b> tpi</a></li>
<li class="chapter" data-level="3.4.2" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#hand"><i class="fa fa-check"></i><b>3.4.2</b> hand</a></li>
<li class="chapter" data-level="3.4.3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#sand"><i class="fa fa-check"></i><b>3.4.3</b> sand</a></li>
<li class="chapter" data-level="3.4.4" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#d8slope"><i class="fa fa-check"></i><b>3.4.4</b> d8slope</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#Applied-Hydrology-Risk-Management"><i class="fa fa-check"></i><b>3.5</b> Applied Hydrology &amp; Risk Management</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#gfplain"><i class="fa fa-check"></i><b>3.5.1</b> gfplain</a></li>
<li class="chapter" data-level="3.5.2" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#flowpath"><i class="fa fa-check"></i><b>3.5.2</b> flowpath</a></li>
<li class="chapter" data-level="3.5.3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#damcourse"><i class="fa fa-check"></i><b>3.5.3</b> damcourse</a></li>
<li class="chapter" data-level="3.5.4" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#damsections"><i class="fa fa-check"></i><b>3.5.4</b> damsections</a></li>
<li class="chapter" data-level="3.5.5" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#dambreak"><i class="fa fa-check"></i><b>3.5.5</b> dambreak</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>4</b> Parts</a></li>
<li class="chapter" data-level="5" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>5</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="5.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>5.1</b> Footnotes</a></li>
<li class="chapter" data-level="5.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>5.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>6</b> Blocks</a>
<ul>
<li class="chapter" data-level="6.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>6.1</b> Equations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="blocks.html"><a href="blocks.html#AverageFlowpathSlope"><i class="fa fa-check"></i><b>6.1.1</b> AverageFlowpathSlope</a></li>
<li class="chapter" data-level="6.1.2" data-path="blocks.html"><a href="blocks.html#AverageUpslopeFlowpathLength"><i class="fa fa-check"></i><b>6.1.2</b> AverageUpslopeFlowpathLength</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>6.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="6.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>6.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>7</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>7.1</b> Publishing</a></li>
<li class="chapter" data-level="7.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>7.2</b> 404 pages</a></li>
<li class="chapter" data-level="7.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>7.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">TerraHidro User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="hydrological-analysis" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Hydrological Analysis<a href="hydrological-analysis.html#hydrological-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="DEM-Pre-processing-and-Correction" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> DEM Pre-processing and Correction<a href="hydrological-analysis.html#DEM-Pre-processing-and-Correction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This group of algorithms is designed to transform a raw Digital Elevation Model (DEM) into a hydrologically correct surface where water can flow uninterrupted to the watershed outlet. It addresses common DEM errors like pits (depressions), flat areas, and misalignments with known river networks. The output is a “pitless” and “conditioned” DEM that is essential for accurate flow direction, watershed delineation, and subsequent hydrological analysis.</p>
<ul>
<li><a href="hydrological-analysis.html#simplepits">simplepits</a></li>
<li><a href="hydrological-analysis.html#agreedem">agreedem</a></li>
<li><a href="hydrological-analysis.html#carve">carve</a></li>
<li><a href="hydrological-analysis.html#carvev">carvev</a></li>
<li><a href="hydrological-analysis.html#fill">fill</a></li>
<li><a href="hydrological-analysis.html#flatareas">flatareas</a></li>
<li><a href="hydrological-analysis.html#pfs">pfs</a></li>
<li><a href="hydrological-analysis.html#pfsd">pfsd</a></li>
<li><a href="hydrological-analysis.html#removepits">removepits</a></li>
</ul>
<div id="simplepits" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> simplepits<a href="hydrological-analysis.html#simplepits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>simplepits</code> is an initial, targeted step for removing hydrological depressions (pits) from a Digital Elevation Model (DEM) while keeping changes to the terrain as small as possible. In pit removal there are three general strategies—fill, carve/breach, or hybrid. Filling is the simplest, but applying it indiscriminately can trigger a cascade: fixing one pit creates new pits in neighboring cells, which leads to further fills and can produce artificial flat areas that were not present in the original DEM. To avoid this, <code>simplepits</code> focuses only on <strong>simple pits</strong>—those that can be eliminated by a single, localized elevation increase without causing any neighboring cell to become a new pit. The algorithm proceeds with a controlled trial-and-error step: it tentatively raises the pit cell by a small amount, checks the surrounding cells, and <strong>accepts</strong> the change only if no new pits appear. If any adjacent cell becomes a pit, the change is <strong>reverted</strong> and that cell is labeled a <strong>complex pit</strong> to be handled later. Operationally, it runs in linear time with respect to the number of pit cells and is intended as a conservative first pass before more comprehensive conditioning.</p>
<p>In TerraHidro there are two functionalities for pit removal: <code>simplepits</code> and <a href="hydrological-analysis.html#pfs"><code>pfs</code></a>. The <code>simplepits</code> functionality modifies <strong>only the pit cell</strong>. A new elevation is assigned to that cell based on the <strong>lowest neighboring elevation plus a predefined increment</strong> (in practice, <code>1e-3</code>). After this increment is applied, <strong>all neighboring cells</strong> of the pit must be checked to ensure that no new pits were created. If <strong>none</strong> of the neighbors becomes a pit, the original pit is considered resolved by a simple, local operation and is classified as a <strong>simple pit</strong>. If <strong>any</strong> neighbor becomes a pit, the modification is <strong>undone</strong> and that pit cell is deferred to <code>pfs</code>, which handles <strong>complex pits</strong>.</p>
<p><img src="fig/simplepits.png" />
<strong>Figure - Simple pit resolution (a–b).</strong> (a) Initial DEM with pit cell C2 (orange) and D8 flow directions (blue). (b) C2 is raised to the lowest neighboring cell (D3) by a small increment, eliminating the pit without creating adjacent pits; the edit is accepted as a simple-pit case.</p>
<table>
<thead>
<tr class="header">
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dem</code></td>
<td>Input raster DEM file <em>(e.g.,inputDEM.tif)</em></td>
</tr>
<tr class="even">
<td><code>output</code></td>
<td>Output raster file <em>(e.g., <code>outputDEM.tif</code>)</em></td>
</tr>
</tbody>
</table>
<p>The following example demonstrates how to use <code>simplepits</code> tool from the command line:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="hydrological-analysis.html#cb5-1" tabindex="-1"></a><span class="ex">th</span> simplepits inputDEM.tif outputDEM.tif</span></code></pre></div>
<p><em>Reference</em>:</p>
<p>Jardim, A. C. (2017). <em>Direções de fluxo em modelos digitais de elevação: um método com foco na qualidade da estimativa e processamento de grande volume de dados</em> [Doctoral dissertation, Instituto Nacional de Pesquisas Espaciais (INPE)]. <a href="http://mtc-m21b.sid.inpe.br/col/sid.inpe.br/mtc-m21b/2017/05.17.13.26/doc/publicacao.pdf?metadatarepository=sid.inpe.br/mtc-m21b/2017/05.17.13.26.57&amp;mirror=sid.inpe.br/mtc-m21b/2013/09.26.14.25.22&amp;languagebutton=en">https://sid.inpe.br/mtc-m21b/2017/05.17.13.26</a></p>
<p><em>See also</em>: <a href="hydrological-analysis.html#pfs">pfs</a>, <a href="hydrological-analysis.html#removepits">removepits</a>.</p>
</div>
<div id="agreedem" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> agreedem<a href="hydrological-analysis.html#agreedem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>agreedem</em> modifies a Digital Elevation Model (DEM) to conform to a known drainage network. The tool sharpens the elevation values along the network’s cells, effectively burning the channels into the terrain. Users can optionally define a buffer to smooth the elevation of adjacent cells, enhancing the integration of the network with the surrounding topography. This process ensures the DEM’s flow directions align with the provided drainage paths.</p>
<p>Input parameters control the sharpening intensity on the network and the degree of smoothing within the specified buffer zone. The tool supports both fixed and variable buffer sizes, which can be defined by an attribute in the input vector data. This operation produces a hydrologically conditioned DEM suitable for subsequent flow routing analysis.</p>
</div>
<div id="carve" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> carve<a href="hydrological-analysis.html#carve" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>carve</em> processes flat areas in a Digital Elevation Model (DEM) by creating an artificial drainage path. The algorithm modifies cell elevations to introduce a slope, enabling hydrological flow routing. It optionally uses a reference drainage network to guide the carving process, ensuring the resulting channel aligns with known flow paths.</p>
<p>The tool requires input parameters to specify whether the drainage network is active (DRNON) and which neighboring cells define a flat area’s border (CROSS, DIAG, or ALL). Unlike carvev, which converges carving toward the center of a flat area, carve uses the drainage network to direct the carving trajectory, producing a more accurate hydrological representation.</p>
<p><em>See also</em>: <a href="hydrological-analysis.html#carvev">carvev</a>.</p>
<p><strong>Parameters</strong></p>
<table>
<colgroup>
<col width="9%" />
<col width="90%" />
</colgroup>
<thead>
<tr class="header">
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-i, --dem</code></td>
<td>Input DEM raster file (e.g., <code>inputDEM.tif</code>).</td>
</tr>
<tr class="even">
<td><code>--drainage</code></td>
<td>Input drainage network (vector <code>.shp</code> or raster), e.g., <code>inputDrainage.shp</code>.</td>
</tr>
<tr class="odd">
<td><code>--flat</code></td>
<td>Input flat-areas raster produced by the <em>flatareas</em> functionality (e.g., <code>inputFlatAreas.tif</code>).</td>
</tr>
<tr class="even">
<td><code>--use-drainage</code></td>
<td>Defines if the drainage network must be used: <br/>• <code>DRNON</code> – converge ao canal <br/>• <code>DRNOFF</code> – não usa a rede, converge ao centro das planícies (similar ao <code>carvev</code>).</td>
</tr>
<tr class="odd">
<td><code>--border</code></td>
<td>Defines which cells form the border of flat areas: <br/>• <code>CROSS</code> – vizinhos horizontais/verticais <br/>• <code>DIAG</code> – vizinhos diagonais <br/>• <code>ALL</code> – todas as direções (8).</td>
</tr>
<tr class="even">
<td><code>-o, --output</code></td>
<td>Output DEM raster file with carved flats (e.g., <code>outputDEM.tif</code>).</td>
</tr>
</tbody>
</table>
<p><strong>C++ function</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="hydrological-analysis.html#cb6-1" tabindex="-1"></a><span class="ex">th</span> carve inputDEM.tif inputDrainage.shp inputFlatAreas.tif DRNON<span class="kw">|</span><span class="ex">DRNOFF</span> CROSS<span class="kw">|</span><span class="ex">DIAG</span><span class="kw">|</span><span class="ex">ALL</span> outputDEM.tif</span></code></pre></div>
</div>
<div id="carvev" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> carvev<a href="hydrological-analysis.html#carvev" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>carvev</em> processes flat areas in a Digital Elevation Model (DEM) by systematically decreasing elevation values from the borders toward the center. This algorithm generates an artificial slope across the feature, forming a characteristic stair-step pattern that enables hydrological flow routing. The operation functions without external drainage data, using only the DEM’s own geometry to determine the carving path.</p>
<p>This method provides a foundational correction for hydrologic conditioning. The key distinction from carve is that carvev does not utilize a reference drainage network to guide the process, converging instead on the geometric center of the flat area.</p>
<table>
<colgroup>
<col width="26%" />
<col width="73%" />
</colgroup>
<thead>
<tr class="header">
<th>Flag</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dem</code></td>
<td>Input DEM raster file <em>(e.g.,inputDEM.tif)</em></td>
</tr>
<tr class="even">
<td><code>output</code></td>
<td>Output DEM raster file with carved flats <em>(e.g., <code>outputDEM.tif</code>)</em></td>
</tr>
</tbody>
</table>
<p><strong>C++ function</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="hydrological-analysis.html#cb7-1" tabindex="-1"></a><span class="ex">th</span> carvev inputDEM.tif outputDEM.tif</span></code></pre></div>
</div>
<div id="fill" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> fill<a href="hydrological-analysis.html#fill" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>fill</em> corrects voids or areas of missing data in a Digital Elevation Model (DEM). The tool uses a separate, often coarser-resolution, reference DEM to supply elevation values for these regions. It replaces null or erroneous cells in the input DEM with corresponding data from the reference source.</p>
<p>This process generates a continuous, hydrologically viable elevation surface. The output DEM supports subsequent terrain analysis by ensuring complete spatial data coverage without interruptions.</p>
</div>
<div id="flatareas" class="section level3 hasAnchor" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> flatareas<a href="hydrological-analysis.html#flatareas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>flatareas</em> identifies contiguous regions of uniform elevation within a Digital Elevation Model (DEM). The tool scans the input raster for adjacent cells possessing identical elevation values. It then groups these cells into distinct flat features.</p>
<p>The algorithm requires a user-defined minimum area threshold, specified as a number of cells. This parameter excludes smaller, potentially insignificant flat zones from the output. The result is a raster layer where each flat area is classified, providing a basis for subsequent hydrological conditioning procedures.</p>
</div>
<div id="pfs" class="section level3 hasAnchor" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> pfs<a href="hydrological-analysis.html#pfs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>pfs</em> removes depressions from a Digital Elevation Model (DEM) using a priority-first search algorithm. The tool initiates a grid search from each pit cell to locate the nearest spill point with a lower elevation. It employs a priority queue to evaluate potential paths, constructing a descending elevation trajectory to the outlet.</p>
<p>This process modifies cell values along the selected path to create a hydrologically continuous surface. The algorithm ensures all depressions are resolved, producing a pit-free DEM suitable for subsequent flow-direction analysis.</p>
</div>
<div id="pfsd" class="section level3 hasAnchor" number="3.1.8">
<h3><span class="header-section-number">3.1.8</span> pfsd<a href="hydrological-analysis.html#pfsd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>pfsd</em> removes depressions from a Digital Elevation Model (DEM) using a priority-first search algorithm that incorporates a reference drainage network. The tool prioritizes the processing of pits located on the drainage network before addressing upstream depressions. It constructs hydrologic outlets by carving descending elevation paths to the nearest lower cell.</p>
<p>This method ensures the resulting drainage structure aligns with the provided network. The algorithm differs from pfs by utilizing the drainage network to guide the depression-removal sequence, enhancing hydrological consistency with known channel locations.</p>
</div>
<div id="removepits" class="section level3 hasAnchor" number="3.1.9">
<h3><span class="header-section-number">3.1.9</span> removepits<a href="hydrological-analysis.html#removepits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>removepits</em> processes a Digital Elevation Model (DEM) to eliminate hydrological depressions and flat areas. This tool executes a sequence of operations, specifically the carvev, simplepits, and pfs algorithms, to ensure comprehensive hydrological correction. It produces a fully connected drainage surface where water can flow uninterrupted to the watershed outlet.</p>
<p>The procedure first addresses flat regions by carving drainage paths, then removes simple pits through elevation filling, and finally resolves complex depressions via priority-first search. The output is a pit-free DEM suitable for deriving accurate flow direction and accumulation networks.</p>
</div>
</div>
<div id="Flow-Analysis-Drainage-Network-Extraction-and-Characterization" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Flow Analysis, Drainage Network Extraction and Characterization<a href="hydrological-analysis.html#Flow-Analysis-Drainage-Network-Extraction-and-Characterization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="hydrological-analysis.html#d8">d8</a><br />
</li>
<li><a href="hydrological-analysis.html#d8ca">d8ca</a><br />
</li>
<li><a href="hydrological-analysis.html#d8drainage">d8drainage</a><br />
</li>
<li><a href="hydrological-analysis.html#d8drainagev">d8drainagev</a><br />
</li>
<li><a href="hydrological-analysis.html#segments">segments</a><br />
</li>
<li><a href="hydrological-analysis.html#minibasins">minibasins</a><br />
</li>
<li><a href="hydrological-analysis.html#outletbasin">outletbasin</a><br />
</li>
<li><a href="hydrological-analysis.html#mainriver">mainriver</a><br />
</li>
<li><a href="hydrological-analysis.html#shreve">shreve</a><br />
</li>
<li><a href="hydrological-analysis.html#strahler">strahler</a><br />
</li>
<li><a href="hydrological-analysis.html#ottorivers">ottorivers</a><br />
</li>
<li><a href="hydrological-analysis.html#mouths">mouths</a><br />
</li>
<li><a href="hydrological-analysis.html#orderedmouths">orderedmouths</a></li>
<li><a href="hydrological-analysis.html#ottorivers">ottorivers</a></li>
</ul>
<div id="d8" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> d8<a href="hydrological-analysis.html#d8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8ca" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> d8ca<a href="hydrological-analysis.html#d8ca" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8drainage" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> d8drainage<a href="hydrological-analysis.html#d8drainage" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8drainagev" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> d8drainagev<a href="hydrological-analysis.html#d8drainagev" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="segments" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> segments<a href="hydrological-analysis.html#segments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="minibasins" class="section level3 hasAnchor" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> minibasins<a href="hydrological-analysis.html#minibasins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="outletbasin" class="section level3 hasAnchor" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> outletbasin<a href="hydrological-analysis.html#outletbasin" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="mainriver" class="section level3 hasAnchor" number="3.2.8">
<h3><span class="header-section-number">3.2.8</span> mainriver<a href="hydrological-analysis.html#mainriver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="shreve" class="section level3 hasAnchor" number="3.2.9">
<h3><span class="header-section-number">3.2.9</span> shreve<a href="hydrological-analysis.html#shreve" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="strahler" class="section level3 hasAnchor" number="3.2.10">
<h3><span class="header-section-number">3.2.10</span> strahler<a href="hydrological-analysis.html#strahler" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="ottorivers" class="section level3 hasAnchor" number="3.2.11">
<h3><span class="header-section-number">3.2.11</span> ottorivers<a href="hydrological-analysis.html#ottorivers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="mouths" class="section level3 hasAnchor" number="3.2.12">
<h3><span class="header-section-number">3.2.12</span> mouths<a href="hydrological-analysis.html#mouths" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="orderedmouths" class="section level3 hasAnchor" number="3.2.13">
<h3><span class="header-section-number">3.2.13</span> orderedmouths<a href="hydrological-analysis.html#orderedmouths" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="ottorivers" class="section level3 hasAnchor" number="3.2.14">
<h3><span class="header-section-number">3.2.14</span> ottorivers<a href="hydrological-analysis.html#ottorivers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="Basin-and-Sub-basin-Delineation" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Basin and Sub-basin Delineation<a href="hydrological-analysis.html#Basin-and-Sub-basin-Delineation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="hydrological-analysis.html#minibasins">minibasins</a><br />
</li>
<li><a href="hydrological-analysis.html#outletbasin">outletbasin</a><br />
</li>
<li><a href="hydrological-analysis.html#ottobasins">ottobasins</a></li>
</ul>
<div id="minibasins" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> minibasins<a href="hydrological-analysis.html#minibasins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="outletbasin" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> outletbasin<a href="hydrological-analysis.html#outletbasin" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="ottobasins" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> ottobasins<a href="hydrological-analysis.html#ottobasins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="Geomorphometric-analysis" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Geomorphometric analysis<a href="hydrological-analysis.html#Geomorphometric-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="hydrological-analysis.html#tpi">tpi</a><br />
</li>
<li><a href="hydrological-analysis.html#hand">hand</a><br />
</li>
<li><a href="hydrological-analysis.html#sand">sand</a><br />
</li>
<li><a href="hydrological-analysis.html#d8slope">d8slope</a></li>
</ul>
<div id="tpi" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> tpi<a href="hydrological-analysis.html#tpi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="hand" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> hand<a href="hydrological-analysis.html#hand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="sand" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> sand<a href="hydrological-analysis.html#sand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8slope" class="section level3 hasAnchor" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> d8slope<a href="hydrological-analysis.html#d8slope" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="Applied-Hydrology-Risk-Management" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Applied Hydrology &amp; Risk Management<a href="hydrological-analysis.html#Applied-Hydrology-Risk-Management" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="hydrological-analysis.html#gfplain">gfplain</a><br />
</li>
<li><a href="hydrological-analysis.html#flowpath">flowpath</a><br />
</li>
<li><a href="hydrological-analysis.html#damcourse">damcourse</a><br />
</li>
<li><a href="hydrological-analysis.html#damsections">damsections</a><br />
</li>
<li><a href="hydrological-analysis.html#dambreak">dambreak</a></li>
</ul>
<div id="gfplain" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> gfplain<a href="hydrological-analysis.html#gfplain" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="flowpath" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> flowpath<a href="hydrological-analysis.html#flowpath" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="damcourse" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> damcourse<a href="hydrological-analysis.html#damcourse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="damsections" class="section level3 hasAnchor" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> damsections<a href="hydrological-analysis.html#damsections" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="dambreak" class="section level3 hasAnchor" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> dambreak<a href="hydrological-analysis.html#dambreak" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="parts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
