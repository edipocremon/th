<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Example: | TerraHidro User Manual</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Example: | TerraHidro User Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Example: | TerraHidro User Manual" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Division of Earth Observation and Geoinformatics - DIOTG" />


<meta name="date" content="2025-10-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hydrological-analysis.html"/>
<link rel="next" href="parts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TerraHidro User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#project-highlights"><i class="fa fa-check"></i>Project Highlights</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#qgis-plugin-installation-and-setup"><i class="fa fa-check"></i>QGIS Plugin Installation and Setup</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#installing-the-terrahidro-plugin-in-qgis"><i class="fa fa-check"></i>Installing the TerraHidro Plugin in QGIS</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#configuring-the-terrahidro-environment-variable-windows"><i class="fa fa-check"></i>Configuring the <code>TERRAHIDRO</code> Environment Variable (Windows)</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#final-step"><i class="fa fa-check"></i>Final Step</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#command-line-interface"><i class="fa fa-check"></i>Command-Line Interface</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#example-removing-pits-with-the-pfs-operation"><i class="fa fa-check"></i>Example: Removing Pits with the <code>pfs</code> Operation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html"><i class="fa fa-check"></i><b>3</b> Hydrological Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#DEM-Pre-processing-and-Correction"><i class="fa fa-check"></i><b>3.1</b> DEM Pre-processing and Correction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#simplepits"><i class="fa fa-check"></i><b>3.1.1</b> simplepits</a></li>
<li class="chapter" data-level="3.1.2" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#agreedem"><i class="fa fa-check"></i><b>3.1.2</b> agreedem</a></li>
<li class="chapter" data-level="3.1.3" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#carve"><i class="fa fa-check"></i><b>3.1.3</b> carve</a></li>
<li class="chapter" data-level="3.1.4" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#carvev"><i class="fa fa-check"></i><b>3.1.4</b> carvev</a></li>
<li class="chapter" data-level="3.1.5" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#fill"><i class="fa fa-check"></i><b>3.1.5</b> fill</a></li>
<li class="chapter" data-level="3.1.6" data-path="hydrological-analysis.html"><a href="hydrological-analysis.html#flatareas"><i class="fa fa-check"></i><b>3.1.6</b> flatareas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>4</b> Example:</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="example.html"><a href="example.html#pfs"><i class="fa fa-check"></i><b>4.0.1</b> pfs</a></li>
<li class="chapter" data-level="4.0.2" data-path="example.html"><a href="example.html#pfsd"><i class="fa fa-check"></i><b>4.0.2</b> pfsd</a></li>
<li class="chapter" data-level="4.0.3" data-path="example.html"><a href="example.html#removepits"><i class="fa fa-check"></i><b>4.0.3</b> removepits</a></li>
<li class="chapter" data-level="4.1" data-path="example.html"><a href="example.html#Flow-Analysis-Drainage-Network-Extraction-and-Characterization"><i class="fa fa-check"></i><b>4.1</b> Flow Analysis, Drainage Network Extraction and Characterization</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="example.html"><a href="example.html#d8"><i class="fa fa-check"></i><b>4.1.1</b> d8</a></li>
<li class="chapter" data-level="4.1.2" data-path="example.html"><a href="example.html#d8ca"><i class="fa fa-check"></i><b>4.1.2</b> d8ca</a></li>
<li class="chapter" data-level="4.1.3" data-path="example.html"><a href="example.html#d8drainage"><i class="fa fa-check"></i><b>4.1.3</b> d8drainage</a></li>
<li class="chapter" data-level="4.1.4" data-path="example.html"><a href="example.html#d8drainagev"><i class="fa fa-check"></i><b>4.1.4</b> d8drainagev</a></li>
<li class="chapter" data-level="4.1.5" data-path="example.html"><a href="example.html#segments"><i class="fa fa-check"></i><b>4.1.5</b> segments</a></li>
<li class="chapter" data-level="4.1.6" data-path="example.html"><a href="example.html#minibasins"><i class="fa fa-check"></i><b>4.1.6</b> minibasins</a></li>
<li class="chapter" data-level="4.1.7" data-path="example.html"><a href="example.html#outletbasin"><i class="fa fa-check"></i><b>4.1.7</b> outletbasin</a></li>
<li class="chapter" data-level="4.1.8" data-path="example.html"><a href="example.html#mainriver"><i class="fa fa-check"></i><b>4.1.8</b> mainriver</a></li>
<li class="chapter" data-level="4.1.9" data-path="example.html"><a href="example.html#shreve"><i class="fa fa-check"></i><b>4.1.9</b> shreve</a></li>
<li class="chapter" data-level="4.1.10" data-path="example.html"><a href="example.html#strahler"><i class="fa fa-check"></i><b>4.1.10</b> strahler</a></li>
<li class="chapter" data-level="4.1.11" data-path="example.html"><a href="example.html#ottorivers"><i class="fa fa-check"></i><b>4.1.11</b> ottorivers</a></li>
<li class="chapter" data-level="4.1.12" data-path="example.html"><a href="example.html#mouths"><i class="fa fa-check"></i><b>4.1.12</b> mouths</a></li>
<li class="chapter" data-level="4.1.13" data-path="example.html"><a href="example.html#orderedmouths"><i class="fa fa-check"></i><b>4.1.13</b> orderedmouths</a></li>
<li class="chapter" data-level="4.1.14" data-path="example.html"><a href="example.html#ottorivers"><i class="fa fa-check"></i><b>4.1.14</b> ottorivers</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="example.html"><a href="example.html#Basin-and-Sub-basin-Delineation"><i class="fa fa-check"></i><b>4.2</b> Basin and Sub-basin Delineation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="example.html"><a href="example.html#minibasins"><i class="fa fa-check"></i><b>4.2.1</b> minibasins</a></li>
<li class="chapter" data-level="4.2.2" data-path="example.html"><a href="example.html#outletbasin"><i class="fa fa-check"></i><b>4.2.2</b> outletbasin</a></li>
<li class="chapter" data-level="4.2.3" data-path="example.html"><a href="example.html#ottobasins"><i class="fa fa-check"></i><b>4.2.3</b> ottobasins</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="example.html"><a href="example.html#Geomorphometric-analysis"><i class="fa fa-check"></i><b>4.3</b> Geomorphometric analysis</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="example.html"><a href="example.html#tpi"><i class="fa fa-check"></i><b>4.3.1</b> tpi</a></li>
<li class="chapter" data-level="4.3.2" data-path="example.html"><a href="example.html#hand"><i class="fa fa-check"></i><b>4.3.2</b> hand</a></li>
<li class="chapter" data-level="4.3.3" data-path="example.html"><a href="example.html#sand"><i class="fa fa-check"></i><b>4.3.3</b> sand</a></li>
<li class="chapter" data-level="4.3.4" data-path="example.html"><a href="example.html#d8slope"><i class="fa fa-check"></i><b>4.3.4</b> d8slope</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="example.html"><a href="example.html#Applied-Hydrology-Risk-Management"><i class="fa fa-check"></i><b>4.4</b> Applied Hydrology &amp; Risk Management</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="example.html"><a href="example.html#gfplain"><i class="fa fa-check"></i><b>4.4.1</b> gfplain</a></li>
<li class="chapter" data-level="4.4.2" data-path="example.html"><a href="example.html#flowpath"><i class="fa fa-check"></i><b>4.4.2</b> flowpath</a></li>
<li class="chapter" data-level="4.4.3" data-path="example.html"><a href="example.html#damcourse"><i class="fa fa-check"></i><b>4.4.3</b> damcourse</a></li>
<li class="chapter" data-level="4.4.4" data-path="example.html"><a href="example.html#damsections"><i class="fa fa-check"></i><b>4.4.4</b> damsections</a></li>
<li class="chapter" data-level="4.4.5" data-path="example.html"><a href="example.html#dambreak"><i class="fa fa-check"></i><b>4.4.5</b> dambreak</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>5</b> Parts</a></li>
<li class="chapter" data-level="6" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>6</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>6.1</b> Footnotes</a></li>
<li class="chapter" data-level="6.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>6.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>7</b> Blocks</a>
<ul>
<li class="chapter" data-level="7.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>7.1</b> Equations</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="blocks.html"><a href="blocks.html#AverageFlowpathSlope"><i class="fa fa-check"></i><b>7.1.1</b> AverageFlowpathSlope</a></li>
<li class="chapter" data-level="7.1.2" data-path="blocks.html"><a href="blocks.html#AverageUpslopeFlowpathLength"><i class="fa fa-check"></i><b>7.1.2</b> AverageUpslopeFlowpathLength</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>7.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="7.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>7.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>8</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>8.1</b> Publishing</a></li>
<li class="chapter" data-level="8.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>8.2</b> 404 pages</a></li>
<li class="chapter" data-level="8.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>8.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">TerraHidro User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Example:<a href="example.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="example.html#cb11-1" tabindex="-1"></a><span class="co"># th flatareas inputDEM.tif 25 outputFlatAreas.tif</span></span></code></pre></div>
<div id="pfs" class="section level3 hasAnchor" number="4.0.1">
<h3><span class="header-section-number">4.0.1</span> pfs<a href="example.html#pfs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>pfs</em> removes depressions from a Digital Elevation Model (DEM) using a priority-first search algorithm. The tool initiates a grid search from each pit cell to locate the nearest spill point with a lower elevation. It employs a priority queue to evaluate potential paths, constructing a descending elevation trajectory to the outlet.</p>
<p>This process modifies cell values along the selected path to create a hydrologically continuous surface. The algorithm ensures all depressions are resolved, producing a pit-free DEM suitable for subsequent flow-direction analysis.</p>
<p><code>pfs</code> removes all remaining depressions from a DEM by <strong>carving a path</strong> from each pit cell to an outlet cell using a <strong>Priority-First Search (PFS)</strong>. Unlike <code>simplepits</code>, which changes only the pit cell, <code>pfs</code> modifies the elevations of <strong>multiple cells</strong> along a selected path so that flow can proceed continuously from the original pit to a lower cell. To <strong>minimize DEM alteration</strong>, the path is chosen to be as <strong>short as possible</strong> toward the <strong>lowest reachable elevation</strong>; if no valid interior cell is found first, the path may end at an invalid cell or at the DEM border.</p>
<p>The DEM is treated as a <strong>graph</strong> in which each grid cell is a node and neighborhood relations (typically 8-connected) are edges. Starting at the pit (initial node), PFS explores neighboring cells using a <strong>priority queue</strong> ordered by desirability—first by <strong>lower elevation</strong>, and, in case of ties, by <strong>shorter path length</strong> from the pit. As cells are visited, the algorithm maintains a <strong>tree of paths</strong> (parent–child relations) that encodes all partial routes under consideration. When PFS reaches a final cell that satisfies the stop criteria (lower elevation and shortest distance), it <strong>commits the path</strong> from the pit to that outlet and proceeds to modify the DEM along that path.</p>
<p><img src="fig/th_pfs1.png" />
<strong>Figure - PFS search to remove a pit.</strong> The priority queue tracks, for each visited cell, its elevation, the number of steps from the pit (path length), and its parent. The final path (e.g., B2–C2–D3–D4) is committed and marked in the path tree (Jardim, 2017).</p>
<p>Elevation modification is applied by creating a <strong>linear downslope</strong> along the chosen path: moving outward from the pit, each intermediate cell along the route receives an elevation <strong>slightly lower</strong> than its predecessor, using a small <strong>decrement step</strong> (in practice, <code>1e-3</code>) applied cell by cell; the <strong>first (pit)</strong> and <strong>last (outlet)</strong> cells are not adjusted. This yields a gentle carved profile that preserves local relief while ensuring drainage continuity. To prevent creating a new pit near the outlet, PFS includes a <strong>stop condition</strong> that guarantees the computed elevation at the cell before the outlet will still be <strong>higher</strong> than the outlet’s elevation given the cumulative decrements; otherwise, the route is rejected and search continues. Border or invalid cells may also serve as terminating outlets under the stop criteria.</p>
<p><img src="fig/th_pfs_grid.png" />
<strong>Figure - DEM modification by a linear slope</strong> . Example before (a) and after (b) applying a constant decrement along the committed path (illustrated here with a larger step of <code>1e-1</code> for clarity), leaving the pit and outlet cells unaltered (Jardim, 2017).</p>
<p>In practice, <code>pfs</code> complements <code>simplepits</code>: simple depressions are removed first with single-cell fills; <strong>complex</strong> ones are then resolved by PFS carving. The result is a <strong>pitless DEM</strong> suitable for reliable flow-direction, contributing-area, and drainage-network derivations, with <strong>minimal distortion</strong> relative to the original topography.</p>
<table>
<thead>
<tr class="header">
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dem</code></td>
<td>Input raster DEM file <em>(e.g.,inputDEM.tif)</em></td>
</tr>
<tr class="even">
<td><code>output</code></td>
<td>Output raster file <em>(e.g., <code>outputDEM.tif</code>)</em></td>
</tr>
</tbody>
</table>
<p>The following example demonstrates how to use <code>simplepits</code> tool from the command line:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="example.html#cb12-1" tabindex="-1"></a><span class="ex">th</span> pfs inputDEM.tif outputDEM.tif</span></code></pre></div>
<p><em>Reference</em>:</p>
<p>Jones, R. (2002). Algorithms for using a DEM for mapping catchment areas of stream sediment samples. Computers &amp; geosciences, v. 28, n. 9, p. 1051–1060. <a href="https://doi.org/10.1016/S0098-3004(02)00022-5">https://doi.org/10.1016/S0098-3004(02)00022-5</a></p>
<p>Jardim, A. C. (2017). <em>Direções de fluxo em modelos digitais de elevação: um método com foco na qualidade da estimativa e processamento de grande volume de dados</em> [Doctoral dissertation, Instituto Nacional de Pesquisas Espaciais (INPE)]. <a href="http://mtc-m21b.sid.inpe.br/col/sid.inpe.br/mtc-m21b/2017/05.17.13.26/doc/publicacao.pdf?metadatarepository=sid.inpe.br/mtc-m21b/2017/05.17.13.26.57&amp;mirror=sid.inpe.br/mtc-m21b/2013/09.26.14.25.22&amp;languagebutton=en">https://sid.inpe.br/mtc-m21b/2017/05.17.13.26</a></p>
<p><em>See also</em>: <a href="hydrological-analysis.html#simplepits">simplepits</a>, <a href="example.html#removepits">removepits</a>.</p>
</div>
<div id="pfsd" class="section level3 hasAnchor" number="4.0.2">
<h3><span class="header-section-number">4.0.2</span> pfsd<a href="example.html#pfsd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>pfsd</em> removes depressions from a Digital Elevation Model (DEM) using a priority-first search algorithm that incorporates a reference drainage network. The tool prioritizes the processing of pits located on the drainage network before addressing upstream depressions. It constructs hydrologic outlets by carving descending elevation paths to the nearest lower cell.</p>
<p>This method ensures the resulting drainage structure aligns with the provided network. The algorithm differs from pfs by utilizing the drainage network to guide the depression-removal sequence, enhancing hydrological consistency with known channel locations.</p>
</div>
<div id="removepits" class="section level3 hasAnchor" number="4.0.3">
<h3><span class="header-section-number">4.0.3</span> removepits<a href="example.html#removepits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>removepits</em> processes a Digital Elevation Model (DEM) to eliminate hydrological depressions and flat areas. This tool executes a sequence of operations, specifically the carvev, simplepits, and pfs algorithms, to ensure comprehensive hydrological correction. It produces a fully connected drainage surface where water can flow uninterrupted to the watershed outlet.</p>
<p>The procedure first addresses flat regions by carving drainage paths, then removes simple pits through elevation filling, and finally resolves complex depressions via priority-first search. The output is a pit-free DEM suitable for deriving accurate flow direction and accumulation networks.</p>
</div>
<div id="Flow-Analysis-Drainage-Network-Extraction-and-Characterization" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Flow Analysis, Drainage Network Extraction and Characterization<a href="example.html#Flow-Analysis-Drainage-Network-Extraction-and-Characterization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="example.html#d8">d8</a><br />
</li>
<li><a href="example.html#d8ca">d8ca</a><br />
</li>
<li><a href="example.html#d8drainage">d8drainage</a><br />
</li>
<li><a href="example.html#d8drainagev">d8drainagev</a><br />
</li>
<li><a href="example.html#segments">segments</a><br />
</li>
<li><a href="example.html#minibasins">minibasins</a><br />
</li>
<li><a href="example.html#outletbasin">outletbasin</a><br />
</li>
<li><a href="example.html#mainriver">mainriver</a><br />
</li>
<li><a href="example.html#shreve">shreve</a><br />
</li>
<li><a href="example.html#strahler">strahler</a><br />
</li>
<li><a href="example.html#ottorivers">ottorivers</a><br />
</li>
<li><a href="example.html#mouths">mouths</a><br />
</li>
<li><a href="example.html#orderedmouths">orderedmouths</a></li>
<li><a href="example.html#ottorivers">ottorivers</a></li>
</ul>
<div id="d8" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> d8<a href="example.html#d8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8ca" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> d8ca<a href="example.html#d8ca" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8drainage" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> d8drainage<a href="example.html#d8drainage" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8drainagev" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> d8drainagev<a href="example.html#d8drainagev" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="segments" class="section level3 hasAnchor" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> segments<a href="example.html#segments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="minibasins" class="section level3 hasAnchor" number="4.1.6">
<h3><span class="header-section-number">4.1.6</span> minibasins<a href="example.html#minibasins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="outletbasin" class="section level3 hasAnchor" number="4.1.7">
<h3><span class="header-section-number">4.1.7</span> outletbasin<a href="example.html#outletbasin" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="mainriver" class="section level3 hasAnchor" number="4.1.8">
<h3><span class="header-section-number">4.1.8</span> mainriver<a href="example.html#mainriver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="shreve" class="section level3 hasAnchor" number="4.1.9">
<h3><span class="header-section-number">4.1.9</span> shreve<a href="example.html#shreve" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="strahler" class="section level3 hasAnchor" number="4.1.10">
<h3><span class="header-section-number">4.1.10</span> strahler<a href="example.html#strahler" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="ottorivers" class="section level3 hasAnchor" number="4.1.11">
<h3><span class="header-section-number">4.1.11</span> ottorivers<a href="example.html#ottorivers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="mouths" class="section level3 hasAnchor" number="4.1.12">
<h3><span class="header-section-number">4.1.12</span> mouths<a href="example.html#mouths" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="orderedmouths" class="section level3 hasAnchor" number="4.1.13">
<h3><span class="header-section-number">4.1.13</span> orderedmouths<a href="example.html#orderedmouths" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="ottorivers" class="section level3 hasAnchor" number="4.1.14">
<h3><span class="header-section-number">4.1.14</span> ottorivers<a href="example.html#ottorivers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="Basin-and-Sub-basin-Delineation" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Basin and Sub-basin Delineation<a href="example.html#Basin-and-Sub-basin-Delineation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="example.html#minibasins">minibasins</a><br />
</li>
<li><a href="example.html#outletbasin">outletbasin</a><br />
</li>
<li><a href="example.html#ottobasins">ottobasins</a></li>
</ul>
<div id="minibasins" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> minibasins<a href="example.html#minibasins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="outletbasin" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> outletbasin<a href="example.html#outletbasin" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="ottobasins" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> ottobasins<a href="example.html#ottobasins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="Geomorphometric-analysis" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Geomorphometric analysis<a href="example.html#Geomorphometric-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="example.html#tpi">tpi</a><br />
</li>
<li><a href="example.html#hand">hand</a><br />
</li>
<li><a href="example.html#sand">sand</a><br />
</li>
<li><a href="example.html#d8slope">d8slope</a></li>
</ul>
<div id="tpi" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> tpi<a href="example.html#tpi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="hand" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> hand<a href="example.html#hand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="sand" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> sand<a href="example.html#sand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="d8slope" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> d8slope<a href="example.html#d8slope" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="Applied-Hydrology-Risk-Management" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Applied Hydrology &amp; Risk Management<a href="example.html#Applied-Hydrology-Risk-Management" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="example.html#gfplain">gfplain</a><br />
</li>
<li><a href="example.html#flowpath">flowpath</a><br />
</li>
<li><a href="example.html#damcourse">damcourse</a><br />
</li>
<li><a href="example.html#damsections">damsections</a><br />
</li>
<li><a href="example.html#dambreak">dambreak</a></li>
</ul>
<div id="gfplain" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> gfplain<a href="example.html#gfplain" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="flowpath" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> flowpath<a href="example.html#flowpath" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="damcourse" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> damcourse<a href="example.html#damcourse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="damsections" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> damsections<a href="example.html#damsections" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="dambreak" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> dambreak<a href="example.html#dambreak" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hydrological-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="parts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
